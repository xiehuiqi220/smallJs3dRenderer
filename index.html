<!DOCTYPE html>
<html>

<head>
  <title>A small 3d renderer based on js and canvas, no webgl</title>
  <meta charset="UTF-8" />
  <style>
    body {
      margin: 0;
    }

    form {
      position: absolute;
      width: 245px;
      right: 0;
      box-sizing: border-box;
      top: 240px;
      color: white;
      border: 1px solid white;
      margin-right: 15px;
      padding: 5px;
    }
  </style>
  <script src="src/loader/obj.js"></script>
</head>

<body>
  <canvas id="myCanvas" width="400" height="400"> </canvas>
  <form enctype="multipart/form-data">
    <label for="upload">upload a obj file</label><br />
    <input id="upload" type="file" accept=".obj" name="files">
    <div>
      <select id="selFile">
        <option value="">select obj example</option>
        <option value="models/teapot.obj">teapot.obj</option>
        <option value="models/CornellBox-Original.obj">CornellBox-Original.obj</option>
        <option value="models/bunny.obj">bunny.obj</option>
        <option value="models/african_head.obj">african_head.obj</option>
        <option value="models/WaltHead.obj">WaltHead.obj</option>
        <option value="models/female02/female02.obj">female02.obj</option>
        <option value="models/male02/male02.obj">male02.obj</option>
      </select>
    </div>
    <div>
      <a href="https://github.com/xiehuiqi220/smallrenderer" target="_blank">github source code</a>
    </div>
  </form>
  <script>
    function $(id) {
      return document.getElementById(id);
    }

    function transferObj(txt) {
      const scene = txt ? ObjParser(txt) : '';
      window.dispatchEvent(new CustomEvent('changeScene', { detail: scene }));
    }
    function changeObj(evt) {
      const path = evt.target.value;
      if (!path) {
        transferObj();
        return;
      }
      const absUrl = 'https://raw.githubusercontent.com/xiehuiqi220/smallrenderer/main/' + path;
      fetch(absUrl).then(r => r.text()).then(txt => {
        transferObj(txt);
      }).catch(ex => alert(ex));
    }
    function uploadFile(evt) {
      const files = evt.target.files;

      let f = files[0];
      if (!f) return;
      let reader = new FileReader();
      reader.onload = (function (theFile) {
        return function (e) {
          const txt = e.target.result;
          transferObj(txt);
        };
      })(f);
      reader.readAsText(f);
    }

    (function main() {
      $('selFile').addEventListener('change', changeObj);
      $('upload').addEventListener('change', uploadFile);
    })();
  </script>
  <script src="src/index.js"></script>
</body>

</html>
